[gd_scene load_steps=18 format=2]

[ext_resource path="res://Scripts/Play/RhythmInput.cs" type="Script" id=1]
[ext_resource path="res://Textures/mask.png" type="Texture" id=2]
[ext_resource path="res://Things/TunnelObjects/Background/Background.tscn" type="PackedScene" id=3]
[ext_resource path="res://Scripts/Play/Playfield.cs" type="Script" id=4]
[ext_resource path="res://Scripts/Chart/NotesCreator.cs" type="Script" id=5]
[ext_resource path="res://Scripts/Play/Play.cs" type="Script" id=6]
[ext_resource path="res://Fonts/Futura/Futura Medium Italic font.ttf" type="DynamicFontData" id=7]
[ext_resource path="res://Scripts/Strikeline.cs" type="Script" id=8]
[ext_resource path="res://Sounds/tick_beat.mp3" type="AudioStream" id=9]

[sub_resource type="Shader" id=7]
code = "shader_type canvas_item;

uniform sampler2D mask_texture;

void fragment() {
    vec4 colour = texture(TEXTURE, UV);
    colour.a *= texture(mask_texture, UV).a;

    COLOR = colour;
}"

[sub_resource type="ShaderMaterial" id=8]
shader = SubResource( 7 )
shader_param/mask_texture = ExtResource( 2 )

[sub_resource type="ViewportTexture" id=6]
viewport_path = NodePath("Notes 3D")

[sub_resource type="DynamicFont" id=5]
size = 46
font_data = ExtResource( 7 )

[sub_resource type="BoxShape" id=1]

[sub_resource type="BoxShape" id=2]
extents = Vector3( 1, 1, 0.1 )

[sub_resource type="BoxShape" id=3]
extents = Vector3( 1, 1, 0.15 )

[sub_resource type="BoxShape" id=4]
extents = Vector3( 1, 1, 0.2 )

[node name="Play" type="Node"]
script = ExtResource( 6 )
npAudioPlayer = NodePath("Notes 3D/BGMPlayer")
npPauseText = NodePath("Display/CenterContainer/Label")

[node name="Display" type="CanvasLayer" parent="."]

[node name="RhythmInput" type="Node" parent="Display"]
script = ExtResource( 1 )

[node name="Notes View" type="TextureRect" parent="Display"]
material = SubResource( 8 )
anchor_right = 1.0
anchor_bottom = 1.0
size_flags_horizontal = 5
size_flags_vertical = 5
texture = SubResource( 6 )
expand = true
stretch_mode = 6
flip_v = true

[node name="CenterContainer" type="CenterContainer" parent="Display"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="Label" type="Label" parent="Display/CenterContainer"]
visible = false
margin_left = 338.0
margin_top = 272.0
margin_right = 686.0
margin_bottom = 328.0
custom_fonts/font = SubResource( 5 )
text = "Game is paused."
align = 1
valign = 1

[node name="Notes 3D" type="Viewport" parent="."]
size = Vector2( 1200, 1200 )
transparent_bg = true
handle_input_locally = false
msaa = 1

[node name="Camera" type="Camera" parent="Notes 3D"]
transform = Transform( -1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 0, 0, 0.327 )
current = true
fov = 20.3
far = 35.0

[node name="Camera2" type="Camera" parent="Notes 3D"]
transform = Transform( -5.73206e-15, 1, 4.37114e-08, -1.31134e-07, -4.37114e-08, 1, 1, 0, 1.31134e-07, 0, 8.002, 1.5 )
fov = 63.7
far = 176.2

[node name="NoteCreator" type="Node" parent="Notes 3D"]
script = ExtResource( 5 )
npScroll = NodePath("../Playfield/Scroll")

[node name="Playfield" type="Spatial" parent="Notes 3D"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 3.84754 )
script = ExtResource( 4 )
npScroll = NodePath("Scroll")
npStrikeline = NodePath("Strikeline")
npTickPlayer = NodePath("../TickPlayer")
npTickDetector = NodePath("Strikeline/TickDetector")

[node name="Strikeline" type="Spatial" parent="Notes 3D/Playfield"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 10, 0, 0, -0.009 )
script = ExtResource( 8 )

[node name="100" type="Area" parent="Notes 3D/Playfield/Strikeline"]

[node name="shape" type="CollisionShape" parent="Notes 3D/Playfield/Strikeline/100"]
shape = SubResource( 1 )

[node name="70" type="Area" parent="Notes 3D/Playfield/Strikeline"]

[node name="shape" type="CollisionShape" parent="Notes 3D/Playfield/Strikeline/70"]
shape = SubResource( 2 )

[node name="50" type="Area" parent="Notes 3D/Playfield/Strikeline"]

[node name="shape" type="CollisionShape" parent="Notes 3D/Playfield/Strikeline/50"]
shape = SubResource( 3 )

[node name="0" type="Area" parent="Notes 3D/Playfield/Strikeline"]

[node name="shape" type="CollisionShape" parent="Notes 3D/Playfield/Strikeline/0"]
shape = SubResource( 4 )

[node name="TickDetector" type="Area" parent="Notes 3D/Playfield/Strikeline"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -2.75373e-05 )

[node name="shape" type="CollisionShape" parent="Notes 3D/Playfield/Strikeline/TickDetector"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1 )
shape = SubResource( 1 )

[node name="Scroll" type="Spatial" parent="Notes 3D/Playfield"]

[node name="Background" parent="Notes 3D/Playfield" instance=ExtResource( 3 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.0745192 )
DrawLength = 7.0

[node name="BGMPlayer" type="AudioStreamPlayer" parent="Notes 3D"]
bus = "BGM"

[node name="TickPlayer" type="AudioStreamPlayer" parent="Notes 3D"]
stream = ExtResource( 9 )
mix_target = 2
bus = "NoteTick"
